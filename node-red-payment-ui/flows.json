[{"id":"4690f7fa.cdc638","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"d65cad5d.309ca","type":"http response","z":"4690f7fa.cdc638","name":"","statusCode":"","headers":{},"x":223.00005722045898,"y":214.00001049041748,"wires":[]},{"id":"b2f060b6.14571","type":"ui_template","z":"4690f7fa.cdc638","group":"ea7d194a.48a818","name":"Display QR Code","order":4,"width":"7","height":"7","format":"<img width=\"80\" height=\"80\" src=\"data:image/png;base64,{{msg.payload}}\" />","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1035.0001258850098,"y":344.00000381469727,"wires":[[]]},{"id":"2a3971ca.56bade","type":"http in","z":"4690f7fa.cdc638","name":"","url":"image","method":"post","upload":true,"swaggerDoc":"","x":75,"y":281.00000858306885,"wires":[["ba748366.ab99f","d65cad5d.309ca"]]},{"id":"5dff7787.33b508","type":"ui_text","z":"4690f7fa.cdc638","group":"357d5bb7.6fe644","order":1,"width":"8","height":"2","name":"","label":"üç¶ Cool kids buy ice-cream from Roboy! üç®","format":"Who wants to be the next cool kid? üòè","layout":"col-center","x":345.6001510620117,"y":84.59998226165771,"wires":[]},{"id":"a4beae2.a24715","type":"ui_template","z":"4690f7fa.cdc638","group":"135535b2.6be5aa","name":"Display order summary","order":1,"width":"7","height":"7","format":"","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1164.600185394287,"y":426.6000061035156,"wires":[[]]},{"id":"65eb5029.2d582","type":"ui_ui_control","z":"4690f7fa.cdc638","name":"","x":964.6003341674805,"y":530.6001415252686,"wires":[[]]},{"id":"c012e8dd.c936a8","type":"function","z":"4690f7fa.cdc638","name":"Show/Hide QR Code","func":"if(msg.payload.payment_option === \"1\"){\n    msg.payload = {\"group\":{\"show\":[\"Payment_QRCode\"]}};\n}\nelse{\n    msg.payload = {\"group\":{\"hide\":[\"Payment_QRCode\"]}};\n}\nreturn msg;","outputs":1,"noerr":0,"x":734.6001815795898,"y":530.6000938415527,"wires":[["65eb5029.2d582"]]},{"id":"c2b24de.7edc4b","type":"ui_gauge","z":"4690f7fa.cdc638","name":"","group":"743fe5c.6630f1c","order":2,"width":"7","height":"7","gtype":"donut","title":"Time Remaining","label":"seconds","format":"{{value}}","min":0,"max":"120","colors":["#ca3838","#e6e600","#00b500"],"seg1":"","seg2":"","x":1604.6002388000488,"y":795.6000108718872,"wires":[]},{"id":"95ad66a3.a7b218","type":"function","z":"4690f7fa.cdc638","name":"Countdown / Stop old loop","func":"msg.payload[\"countdown\"] = Number(msg.payload.timer);\nvar start_new_loop = flow.get('start_new_loop') || false;\n\nmsg.payload.countdown_status = \"stop\";\n\nreturn msg;","outputs":1,"noerr":0,"x":736.6001281738281,"y":661.0000343322754,"wires":[["858d5e47.12d2a","db3f73e9.5dc47","dece84fc.9e0db8"]]},{"id":"858d5e47.12d2a","type":"function","z":"4690f7fa.cdc638","name":"Loop","func":"// Loop function\n// Top output provides triger for next actions\n// Botton output should be connected to the input through a dealy\n// The msg.payload can consis one of actions: start, stop, toggle\n// Other content is ignored\n// On the outoput the msg.payload contains current loop state\n\ncontext.loop = context.loop || \"stop\";\ncontext.countdown = context.countdown || msg.payload.countdown;\n\n//console.log(\"topic :\" + msg.topic);\n//console.log(\"loop  :\" + context.loop);\n//console.log(\"loops :\" + context.loops);\n//console.log(\"action:\" + msg.payload);\n\nswitch (msg.payload.countdown_status) {\n\tcase \"stop\":\n\t\tcontext.countdown = context.countdown - 1;\n\t\tmsg.payload.countdown = context.countdown;\n\t\tmsg.payload.countdown_status = \"stop\";\n\t\tcontext.loop = \"stop\";\n\t\treturn [msg, null];\n\tcase \"start\":\n\t\tmsg.payload.countdown_status = \"started\";\n\t\tcontext.loop = \"loop\";\n\t\tcontext.countdown = msg.payload.countdown;\n\t\treturn [msg, msg];\n\tdefault:\n\t\tif (context.loop == \"loop\") {\n\t\t    if(context.countdown == 1){\n\t\t        context.loop = \"stop\";\n\t\t        msg.payload.countdown_status = \"stop\";\n\t\t        return [msg, msg];\n\t\t    }\n\t\t\tcontext.countdown = context.countdown - 1;\n\t\t\tmsg.payload.countdown = context.countdown;\n\t\t\tmsg.payload.countdown_status = \"loop\";\n\t\t\treturn [msg, msg];\n\t\t} else {\n\t\t\treturn [null, null]; \n\t\t}\n}","outputs":2,"noerr":0,"x":1140.600185394287,"y":687.9999847412109,"wires":[["755abd0e.40a354"],["25504db4.801bd2"]]},{"id":"25504db4.801bd2","type":"delay","z":"4690f7fa.cdc638","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1133.60013961792,"y":833.9999876022339,"wires":[["858d5e47.12d2a"]]},{"id":"755abd0e.40a354","type":"change","z":"4690f7fa.cdc638","name":"Set countdown","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.countdown","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1362.60013961792,"y":682.9999856948853,"wires":[["c2b24de.7edc4b"]]},{"id":"bec25334.a9217","type":"function","z":"4690f7fa.cdc638","name":"Set Gauge Max","func":"msg.ui_control = {min:0, max:msg.payload}\nreturn msg;","outputs":1,"noerr":0,"x":1353.60013961792,"y":948.9999647140503,"wires":[["c2b24de.7edc4b"]]},{"id":"db3f73e9.5dc47","type":"change","z":"4690f7fa.cdc638","name":"Set countdown","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.countdown","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1110.600185394287,"y":949.9999647140503,"wires":[["bec25334.a9217"]]},{"id":"ba748366.ab99f","type":"function","z":"4690f7fa.cdc638","name":"Style Parser","func":"function parseBool(val)\n{\n    if ((typeof val === 'string' && (val.toLowerCase() === 'true' || val.toLowerCase() === 'yes')) || val === 1)\n        return true;\n    else if ((typeof val === 'string' && (val.toLowerCase() === 'false' || val.toLowerCase() === 'no')) || val === 0)\n        return false;\n\n    return null;\n}\n\nflow.set('start_new_loop', true);\n\nif (typeof msg.payload.default !== 'undefined'){\n    msg.payload[\"default\"] = parseBool(msg.payload.default);\n}\nelse{\n    msg.payload[\"default\"] = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":240.40002059936523,"y":279.6000061035156,"wires":[["d609e9ea.df8c18"]]},{"id":"d609e9ea.df8c18","type":"switch","z":"4690f7fa.cdc638","name":"Default/Payment Style","property":"payload.default","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"jsonata"},{"t":"eq","v":"false","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":2,"x":434.40003204345703,"y":278.1999969482422,"wires":[["85a80411.c25508","ac72c63f.b4c4f8","7e9a408d.e7b92","ae882c0a.8bd8b","41572076.36399"],["dd1045f6.0c0988","8f77cb08.59c648","33a15941.1a83f6","f5215db2.c8006","3f86aa6e.990446","10159953.267d57","c012e8dd.c936a8","95ad66a3.a7b218"]]},{"id":"85a80411.c25508","type":"function","z":"4690f7fa.cdc638","name":"Hide QRCode","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_QRCode\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":844.6000137329102,"y":157.00000953674316,"wires":[["c8f9bca7.76b5a"]]},{"id":"c8f9bca7.76b5a","type":"ui_ui_control","z":"4690f7fa.cdc638","name":"","x":1053.2000427246094,"y":166.60000610351562,"wires":[[]]},{"id":"ac72c63f.b4c4f8","type":"function","z":"4690f7fa.cdc638","name":"Hide Info","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_Info\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":825.0000114440918,"y":202.6000099182129,"wires":[["c8f9bca7.76b5a"]]},{"id":"7e9a408d.e7b92","type":"function","z":"4690f7fa.cdc638","name":"Hide Countdown","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_Countdown\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":841.0000114440918,"y":242.6000099182129,"wires":[["c8f9bca7.76b5a"]]},{"id":"dd1045f6.0c0988","type":"function","z":"4690f7fa.cdc638","name":"Show Info","func":"msg.payload = {\"group\":{\"show\":[\"Payment_Info\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":488.4000129699707,"y":735.3999614715576,"wires":[["23f047b8.22cf88"]]},{"id":"8f77cb08.59c648","type":"function","z":"4690f7fa.cdc638","name":"Show Countdown","func":"msg.payload = {\"group\":{\"show\":[\"Payment_Countdown\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":514.4000091552734,"y":781.3999633789062,"wires":[["23f047b8.22cf88"]]},{"id":"23f047b8.22cf88","type":"ui_ui_control","z":"4690f7fa.cdc638","name":"","x":735.000057220459,"y":773.0000114440918,"wires":[[]]},{"id":"ae882c0a.8bd8b","type":"function","z":"4690f7fa.cdc638","name":"Show Text","func":"msg.payload = {\"group\":{\"show\":[\"Payment_Default1\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":841.4000244140625,"y":113,"wires":[["c8f9bca7.76b5a"]]},{"id":"33a15941.1a83f6","type":"function","z":"4690f7fa.cdc638","name":"Hide Text","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_Default1\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":490.00000762939453,"y":824.800012588501,"wires":[["23f047b8.22cf88"]]},{"id":"a392d943.3f1f18","type":"ui_template","z":"4690f7fa.cdc638","group":"352e12ed.807a8e","name":"Ice Cream Logo","order":0,"width":0,"height":0,"format":"<img src=\"/roboy_ice_cream.jpg\">","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":255.40002822875977,"y":142.60000133514404,"wires":[[]]},{"id":"41572076.36399","type":"function","z":"4690f7fa.cdc638","name":"Show Icecream","func":"msg.payload = {\"group\":{\"show\":[\"Payment_Icecream\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":852.4000358581543,"y":73.00000095367432,"wires":[["c8f9bca7.76b5a"]]},{"id":"f5215db2.c8006","type":"function","z":"4690f7fa.cdc638","name":"Hide Icecream","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_Icecream\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":512,"y":870,"wires":[["23f047b8.22cf88"]]},{"id":"3f86aa6e.990446","type":"change","z":"4690f7fa.cdc638","name":"QR Code Image","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.encoded","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":835.6000709533691,"y":344.2000045776367,"wires":[["b2f060b6.14571"]]},{"id":"a0f1779.dee5888","type":"function","z":"4690f7fa.cdc638","name":"Dynamic order table","func":"var htmlstart = '<div align=\"center\"> <table> <tr> <th>Flavor</th> <th>Scoop</th> </tr>'\nvar htmlend = '</table> <br><br/> </div> <div id=\\'price\\'>' + 'Price: '+ msg.payload.price +' ‚Ç¨</div>';\nvar style = '<style> @import url(\\'https://fonts.googleapis.com/css?family=Raleway&display=swap\\'); #price{ font-size: 50px; font-weight: normal; font-family: \\'Raleway\\', sans-serif; color: red; } table { font-family: Raleway, sans-serif; border-collapse: collapse; width: 100%; } td, th { border: 1px solid #dddddd; text-align: left; padding: 8px; } table { font-family: Raleway, sans-serif; font-size: 30px; border-collapse: collapse; width: 100%; } td, th { border: 1px solid #dddddd; text-align: left; padding: 8px; } tr:nth-child(odd) { background-color: #dddddd; }</style>';\n\nvar flavors = msg.payload.flavors;\nvar scoops = msg.payload.scoops;\n\nvar table_content = '';\nif(typeof flavors === 'object'){\n    for(i=0; i<flavors.length; i++){\n        table_content += '<tr> <td> ' + flavors[i] + '</td> <td>' + scoops[i] + '</td> </tr>'\n    }\n}\nelse{\n    table_content += '<tr> <td> ' + flavors + '</td> <td>' + scoops + '</td> </tr>'\n}\n\nmsg.template = style + htmlstart + table_content + htmlend;\nreturn msg;","outputs":1,"noerr":0,"x":912.0000839233398,"y":427.4000053405762,"wires":[["a4beae2.a24715"]]},{"id":"10159953.267d57","type":"function","z":"4690f7fa.cdc638","name":"Cent to Euro","func":"msg.payload.price = Number(msg.payload.price)/100\nreturn msg;","outputs":1,"noerr":0,"x":691.1999855041504,"y":427.4000072479248,"wires":[["a0f1779.dee5888"]]},{"id":"553ef9a3.0040c8","type":"function","z":"4690f7fa.cdc638","name":"Start a new loop","func":"msg.payload.countdown_status = \"start\";\nreturn msg;","outputs":1,"noerr":0,"x":1180.2000427246094,"y":585.7999839782715,"wires":[["858d5e47.12d2a"]]},{"id":"dece84fc.9e0db8","type":"delay","z":"4690f7fa.cdc638","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980.1999893188477,"y":585.7999839782715,"wires":[["553ef9a3.0040c8"]]},{"id":"ea7d194a.48a818","type":"ui_group","z":"","name":"QRCode","tab":"19a2d82f.af7e98","order":1,"disp":false,"width":"7","collapse":false},{"id":"357d5bb7.6fe644","type":"ui_group","z":"","name":"Default1","tab":"19a2d82f.af7e98","order":4,"disp":false,"width":"8","collapse":false},{"id":"135535b2.6be5aa","type":"ui_group","z":"","name":"Info","tab":"19a2d82f.af7e98","order":3,"disp":false,"width":"7","collapse":false},{"id":"743fe5c.6630f1c","type":"ui_group","z":"","name":"Countdown","tab":"19a2d82f.af7e98","order":2,"disp":false,"width":"7","collapse":false},{"id":"352e12ed.807a8e","type":"ui_group","z":"","name":"Icecream","tab":"19a2d82f.af7e98","order":5,"disp":false,"width":"8","collapse":false},{"id":"19a2d82f.af7e98","type":"ui_tab","z":"","name":"Payment","icon":"dashboard","disabled":false,"hidden":false}]