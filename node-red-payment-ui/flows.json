[{"id":"5cb02c2b.7ad684","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"9393e18a.9c39d","type":"http response","z":"5cb02c2b.7ad684","name":"","statusCode":"","headers":{},"x":223.00005722045898,"y":214.00001049041748,"wires":[]},{"id":"98c6021d.10d69","type":"ui_template","z":"5cb02c2b.7ad684","group":"76237eb1.f3461","name":"Display QR Code","order":4,"width":"7","height":"7","format":"<img width=\"80\" height=\"80\" src=\"data:image/png;base64,{{msg.payload}}\" />","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1035.0001258850098,"y":344.00000381469727,"wires":[[]]},{"id":"25ca885e.1911f8","type":"http in","z":"5cb02c2b.7ad684","name":"","url":"image","method":"post","upload":true,"swaggerDoc":"","x":75,"y":281.00000858306885,"wires":[["a5766598.c31978","9393e18a.9c39d"]]},{"id":"de881ae2.269e48","type":"ui_template","z":"5cb02c2b.7ad684","group":"cce573e.69c839","name":"Display order summary","order":1,"width":"7","height":"7","format":"","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1164.600185394287,"y":426.6000061035156,"wires":[[]]},{"id":"bff783d6.bfd29","type":"ui_ui_control","z":"5cb02c2b.7ad684","name":"","x":964.6003341674805,"y":530.6001415252686,"wires":[[]]},{"id":"1bc806f6.539699","type":"function","z":"5cb02c2b.7ad684","name":"Show/Hide QR Code","func":"if(msg.payload.payment_option === \"1\"){\n    msg.payload = {\"group\":{\"show\":[\"Payment_QRCode\"]}};\n}\nelse{\n    msg.payload = {\"group\":{\"hide\":[\"Payment_QRCode\"]}};\n}\nreturn msg;","outputs":1,"noerr":0,"x":734.6001815795898,"y":530.6000938415527,"wires":[["bff783d6.bfd29"]]},{"id":"3b6b933f.6d1c6c","type":"ui_gauge","z":"5cb02c2b.7ad684","name":"","group":"c9343c9.0a03ac","order":2,"width":"7","height":"7","gtype":"donut","title":"Time Remaining","label":"seconds","format":"{{value}}","min":0,"max":"120","colors":["#ca3838","#e6e600","#00b500"],"seg1":"","seg2":"","x":1789.6002655029297,"y":756.6000356674194,"wires":[]},{"id":"e8177991.81e088","type":"function","z":"5cb02c2b.7ad684","name":"Countdown / Stop old loop","func":"msg.payload[\"countdown\"] = Number(msg.payload.timer);\nvar start_new_loop = flow.get('start_new_loop') || false;\n\nmsg.payload.countdown_status = \"stop\";\n\nreturn msg;","outputs":1,"noerr":0,"x":885.6001586914062,"y":646.0000591278076,"wires":[["8716c922.771558","af841efa.41b78","3da21f33.3e831"]]},{"id":"af841efa.41b78","type":"function","z":"5cb02c2b.7ad684","name":"Loop","func":"// Loop function\n// Top output provides triger for next actions\n// Botton output should be connected to the input through a dealy\n// The msg.payload can consis one of actions: start, stop, toggle\n// Other content is ignored\n// On the outoput the msg.payload contains current loop state\n\ncontext.loop = context.loop || \"stop\";\ncontext.countdown = context.countdown || msg.payload.countdown;\n\n//console.log(\"topic :\" + msg.topic);\n//console.log(\"loop  :\" + context.loop);\n//console.log(\"loops :\" + context.loops);\n//console.log(\"action:\" + msg.payload);\n\nswitch (msg.payload.countdown_status) {\n\tcase \"stop\":\n\t\tcontext.countdown = context.countdown - 1;\n\t\tmsg.payload.countdown = context.countdown;\n\t\tmsg.payload.countdown_status = \"stop\";\n\t\tcontext.loop = \"stop\";\n\t\treturn [msg, null];\n\tcase \"start\":\n\t\tmsg.payload.countdown_status = \"started\";\n\t\tcontext.loop = \"loop\";\n\t\tcontext.countdown = msg.payload.countdown;\n\t\treturn [msg, msg];\n\tdefault:\n\t\tif (context.loop == \"loop\") {\n\t\t    if(context.countdown == 1){\n\t\t        context.loop = \"stop\";\n\t\t        msg.payload.countdown_status = \"stop\";\n\t\t        return [msg, msg];\n\t\t    }\n\t\t\tcontext.countdown = context.countdown - 1;\n\t\t\tmsg.payload.countdown = context.countdown;\n\t\t\tmsg.payload.countdown_status = \"loop\";\n\t\t\treturn [msg, msg];\n\t\t} else {\n\t\t\treturn [null, null]; \n\t\t}\n}","outputs":2,"noerr":0,"x":1325.600212097168,"y":649.0000095367432,"wires":[["f07c5604.20ef68"],["5df08435.6990ec"]]},{"id":"5df08435.6990ec","type":"delay","z":"5cb02c2b.7ad684","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1318.6001663208008,"y":795.0000123977661,"wires":[["af841efa.41b78"]]},{"id":"f07c5604.20ef68","type":"change","z":"5cb02c2b.7ad684","name":"Set countdown","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.countdown","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1547.6001663208008,"y":644.0000104904175,"wires":[["3b6b933f.6d1c6c"]]},{"id":"54e009f3.843a68","type":"function","z":"5cb02c2b.7ad684","name":"Set Gauge Max","func":"msg.ui_control = {min:0, max:msg.payload}\nreturn msg;","outputs":1,"noerr":0,"x":1538.6001663208008,"y":909.9999895095825,"wires":[["3b6b933f.6d1c6c"]]},{"id":"3da21f33.3e831","type":"change","z":"5cb02c2b.7ad684","name":"Set countdown","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.countdown","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1295.600212097168,"y":910.9999895095825,"wires":[["54e009f3.843a68"]]},{"id":"a5766598.c31978","type":"function","z":"5cb02c2b.7ad684","name":"Style Parser","func":"function parseBool(val)\n{\n    if ((typeof val === 'string' && (val.toLowerCase() === 'true' || val.toLowerCase() === 'yes')) || val === 1)\n        return true;\n    else if ((typeof val === 'string' && (val.toLowerCase() === 'false' || val.toLowerCase() === 'no')) || val === 0)\n        return false;\n\n    return null;\n}\n\nflow.set('start_new_loop', true);\n\nif (typeof msg.payload.default !== 'undefined'){\n    msg.payload[\"default\"] = parseBool(msg.payload.default);\n}\nelse{\n    msg.payload[\"default\"] = true;\n}\nreturn msg;","outputs":1,"noerr":0,"x":240.40002059936523,"y":279.6000061035156,"wires":[["2b2c1568.c51afa"]]},{"id":"2b2c1568.c51afa","type":"switch","z":"5cb02c2b.7ad684","name":"Default/Payment Style","property":"payload.default","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"jsonata"},{"t":"eq","v":"false","vt":"jsonata"}],"checkall":"true","repair":false,"outputs":2,"x":434.40003204345703,"y":278.1999969482422,"wires":[["10e271f.a71358e","73342272.46a06c","7c0c668c.411928","976dbcba.8c98c","b0da725.1b8879"],["62cd13e9.036afc","84857588.259ef8","899070a0.848ed","4723a8b9.fa80d8","d5b72333.5c5e3","b55e6ac2.9ee368","1bc806f6.539699","d48089e0.1b6878"]]},{"id":"10e271f.a71358e","type":"function","z":"5cb02c2b.7ad684","name":"Hide QRCode","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_QRCode\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":844.6000137329102,"y":157.00000953674316,"wires":[["4ae6cac2.3ef484"]]},{"id":"4ae6cac2.3ef484","type":"ui_ui_control","z":"5cb02c2b.7ad684","name":"","x":1053.2000427246094,"y":166.60000610351562,"wires":[[]]},{"id":"73342272.46a06c","type":"function","z":"5cb02c2b.7ad684","name":"Hide Info","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_Info\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":825.0000114440918,"y":202.6000099182129,"wires":[["4ae6cac2.3ef484"]]},{"id":"7c0c668c.411928","type":"function","z":"5cb02c2b.7ad684","name":"Hide Countdown","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_Countdown\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":841.0000114440918,"y":242.6000099182129,"wires":[["4ae6cac2.3ef484"]]},{"id":"62cd13e9.036afc","type":"function","z":"5cb02c2b.7ad684","name":"Show Info","func":"msg.payload = {\"group\":{\"show\":[\"Payment_Info\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":488.4000129699707,"y":735.3999614715576,"wires":[["4efaaf52.1679c"]]},{"id":"84857588.259ef8","type":"function","z":"5cb02c2b.7ad684","name":"Show Countdown","func":"msg.payload = {\"group\":{\"show\":[\"Payment_Countdown\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":514.4000091552734,"y":781.3999633789062,"wires":[["4efaaf52.1679c"]]},{"id":"4efaaf52.1679c","type":"ui_ui_control","z":"5cb02c2b.7ad684","name":"","x":735.000057220459,"y":773.0000114440918,"wires":[[]]},{"id":"976dbcba.8c98c","type":"function","z":"5cb02c2b.7ad684","name":"Show Text","func":"msg.payload = {\"group\":{\"show\":[\"Payment_Default1\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":841.4000244140625,"y":113,"wires":[["4ae6cac2.3ef484"]]},{"id":"899070a0.848ed","type":"function","z":"5cb02c2b.7ad684","name":"Hide Text","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_Default1\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":490.00000762939453,"y":824.800012588501,"wires":[["4efaaf52.1679c"]]},{"id":"108ed01d.d597e","type":"ui_template","z":"5cb02c2b.7ad684","group":"53854aa8.5d37a4","name":"Ice Cream Logo","order":0,"width":0,"height":0,"format":"<center>\n    <p>\n        <font size=\"4\">\n            Cool kids buy ice-cream from Roboy! üç¶üç®\n        </font>\n    </p>\n    <p>\n        <font size=\"5\">\n            <b>\n                Who wants to be the next cool kid? üòé\n            </b>\n        </font>\n    </p>\n</center>\n<img src=\"/roboy_ice_cream.jpg\">","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":255.40002822875977,"y":142.60000133514404,"wires":[[]]},{"id":"b0da725.1b8879","type":"function","z":"5cb02c2b.7ad684","name":"Show Icecream","func":"msg.payload = {\"group\":{\"show\":[\"Payment_Icecream\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":852.4000358581543,"y":73.00000095367432,"wires":[["4ae6cac2.3ef484"]]},{"id":"4723a8b9.fa80d8","type":"function","z":"5cb02c2b.7ad684","name":"Hide Icecream","func":"msg.payload = {\"group\":{\"hide\":[\"Payment_Icecream\"]}};\nreturn msg;","outputs":1,"noerr":0,"x":512,"y":870,"wires":[["4efaaf52.1679c"]]},{"id":"d5b72333.5c5e3","type":"change","z":"5cb02c2b.7ad684","name":"QR Code Image","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.encoded","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":835.6000709533691,"y":344.2000045776367,"wires":[["98c6021d.10d69"]]},{"id":"1c30327.adc09ce","type":"function","z":"5cb02c2b.7ad684","name":"Dynamic order table","func":"var htmlstart = '<div align=\"center\"> <table> <tr> <th>Flavor</th> <th>Scoop</th> </tr>'\nvar htmlend = '</table> <br><br/> </div> <div id=\\'price\\'>' + 'Price: '+ msg.payload.price +' ‚Ç¨</div> <div id=\\'price\\'>' + 'Paid: &nbsp;'+ msg.payload.paid +' ‚Ç¨</div>';\nvar style = '<style> @import url(\\'https://fonts.googleapis.com/css?family=Raleway&display=swap\\'); #price{ font-size: 50px; font-weight: normal; font-family: \\'Raleway\\', sans-serif; color: red; } table { font-family: Raleway, sans-serif; border-collapse: collapse; width: 100%; } td, th { border: 1px solid #dddddd; text-align: left; padding: 8px; } table { font-family: Raleway, sans-serif; font-size: 30px; border-collapse: collapse; width: 100%; } td, th { border: 1px solid #dddddd; text-align: left; padding: 8px; } tr:nth-child(odd) { background-color: #dddddd; }</style>';\n\nvar flavors = msg.payload.flavors;\nvar scoops = msg.payload.scoops;\n\nfunction capitalizeFirstLetter(string){\n    return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\nvar table_content = '';\nif(typeof flavors === 'object'){\n    for(i=0; i<flavors.length; i++){\n        table_content += '<tr> <td> ' + capitalizeFirstLetter(flavors[i]) + '</td> <td>' + scoops[i] + '</td> </tr>'\n    }\n}\nelse{\n    table_content += '<tr> <td> ' + capitalizeFirstLetter(flavors) + '</td> <td>' + scoops + '</td> </tr>'\n}\n\nmsg.template = style + htmlstart + table_content + htmlend;\nreturn msg;","outputs":1,"noerr":0,"x":912.0000839233398,"y":427.4000053405762,"wires":[["de881ae2.269e48"]]},{"id":"b55e6ac2.9ee368","type":"function","z":"5cb02c2b.7ad684","name":"Cent to Euro","func":"msg.payload.price = Number(msg.payload.price)/100\nmsg.payload.paid = Number(msg.payload.paid)/100\nreturn msg;","outputs":1,"noerr":0,"x":691.1999855041504,"y":427.4000072479248,"wires":[["1c30327.adc09ce"]]},{"id":"a2b7be2c.b2639","type":"function","z":"5cb02c2b.7ad684","name":"Start a new loop","func":"msg.payload.countdown_status = \"start\";\nreturn msg;","outputs":1,"noerr":0,"x":1365.2000694274902,"y":546.8000087738037,"wires":[["af841efa.41b78"]]},{"id":"8716c922.771558","type":"delay","z":"5cb02c2b.7ad684","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1165.2000160217285,"y":546.8000087738037,"wires":[["a2b7be2c.b2639"]]},{"id":"d48089e0.1b6878","type":"switch","z":"5cb02c2b.7ad684","name":"Paid Update","property":"payload.paid","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":642.8000106811523,"y":644.0000095367432,"wires":[["e8177991.81e088"]]},{"id":"76237eb1.f3461","type":"ui_group","z":"","name":"QRCode","tab":"50166b5.297f194","order":1,"disp":false,"width":"7","collapse":false},{"id":"cce573e.69c839","type":"ui_group","z":"","name":"Info","tab":"50166b5.297f194","order":3,"disp":false,"width":"7","collapse":false},{"id":"c9343c9.0a03ac","type":"ui_group","z":"","name":"Countdown","tab":"50166b5.297f194","order":2,"disp":false,"width":"7","collapse":false},{"id":"53854aa8.5d37a4","type":"ui_group","z":"","name":"Icecream","tab":"50166b5.297f194","order":5,"disp":false,"width":"8","collapse":false},{"id":"50166b5.297f194","type":"ui_tab","z":"","name":"Payment","icon":"dashboard","disabled":false,"hidden":false}]